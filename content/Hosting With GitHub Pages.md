Title: Hosting With GitHub Pages
Date: 2013-12-07
Slug: hosting-with-github-pages
Status: draft

This week, I made the switch to using GitHub as both version control for the source of my website but also as its hosting platform through [GitHub Pages](http://pages.github.com). I initially thought the move would be confusing and time-consuming, but after the DNS changes propagated, everything was running fine with only a few minutes of downtime.

There are two different types of GitHub Pages: User (or Organization) Pages and Project Pages. Being my personal website and blog, this website is a User Page hosted from the repository `iKevinY/iKevinY.github.io`. For User Pages, the content that is hosted must be located in the `master` branch of the `*.github.io` repository. Since I didn't want to have two separate repositories for the source of the website and the generated files, I opted to make a branch, `src`, containing the source files. While I thought this would be complicated, it wasn't all too difficult.

Within the root directory of my website's source, there is an `output` directory that the static site files generated by [Pelican](http://getpelican.com) go. Prior to using GitHub Pages, I had written a Bash script titled `generate.sh` that would upload the `output` directory to the web server using rsync. Obviously, this script had to be rewritten as in order to update my website through GitHub Pages, commits need to be pushed to the `master` branch of `iKevinY.github.io` instead of files being uploaded.

To accomplish this, there is a Git repository in the root directory and also in the output directory, and both remotes are configured to push to `iKevinY.github.io`. The local repository in the root directory has the `output` directory in its `.gitignore` file and commits to the `src` branch, while the `output` repository commits to the `master` branch.

To streamline the upload process, I created an RSA key-pair so that I would not have to manually authenticate every time `git push` was called by the upload script. While this did not work initially, it turns out that I was using the wrong remote URL; the proper URL to use over SSH (which in retrospect is quite obvious) is `ssh://git@github.com:[username]/[repository].git` instead of the HTTPS clone URL that is shown by default on the right side of the page when browsing the repository through GitHub.

After having set up the remote branch for the `output` directory's repository, it is only modified by `generate.sh`. Making use of [GitHub Flavoured Markdown](https://help.github.com/articles/github-flavored-markdown), the commits from the `output` directory (that get pushed to the `master` branch) contain a commit message that references the most recent commit to the `src` branch. When viewing the `master` branch on GitHub, the SHA hashes link to the corresponding commits in the `src` branch that generated the changes in the static site files to make it easy to determine what the cause of any problems was.

To achieve this, the following code is run in `generate.sh` after the `pelican` command is run to generate the site files.

```bash
cd [site source directory]
commitHash=$(git rev-parse HEAD)
cd [output directory]
git checkout master
git add -A
read -p "Enter extended commit message: " commitMessage
if [ -z "$commitMessage"]; then
	git commit -m "Generated by $commitHash"
else
	git commit -m "Generated by $commitHash" -m "$commitMessage"
fi
git push
```

The command `git rev-parse HEAD` returns the SHA hash of the last commit in the Git repository's history, and is stored in the variable `commitHash`. The directory is then changed to the `output` directory and `git checkout` is run to ensure the branch that changes will be committed to is the `master` branch (not that it should change, but this is more of a failsafe to ensure no problems occur). Any changes are then added via `git add -A`.

Following this, the script prompts for an extended commit message (what is shown on GitHub after expanding the commit message with the `â€¦` button). The first line of the commit message is "Generated by" followed by the hash of the last commit made in the `src` branch, and if an extended commit message is provided, the script will add it in. Finally, the commit is pushed to GitHub.

All in all, this solution seems to work flawlessly.
